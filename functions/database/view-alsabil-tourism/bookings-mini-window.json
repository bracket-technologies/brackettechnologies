{
  "creation-date": 1653754089875,
  "type": "View?id=bookings-mini-window;class=flexbox pointer;style:[opacity=0;pointerEvents=none;position=fixed;top=0;left=0;right=0;bottom=0;backgroundColor=#00000060;zIndex=1000;transition=.2s;padding=10vh 5vw];booking-data:().del()",
  "children": [
    {
      "controls": [
        {
          "event": "loaded?search():[collection=agent;doc=booking-data:().agent]:[my-agent:()=().search.data;bookind-data:().():[agent=my-agent:().id;agent-name=my-agent:().company-name];update():booking-agent]"
        }
      ],
      "children": [
        {
          "children": [
            {
              "type": "Text?text=Booking form +if():[booking-copied:()]:(Duplicate).elif():[booking-edit-readonly:()]:(Display).elif():[booking-edit:()]:(Edit):(New);style:[fontSize=1.5rem]"
            },
            {
              "type": "View?class=flexbox;style.gap=1.5rem;style.marginLeft=auto",
              "children": [
                {
                  "children": [
                    {
                      "type": "Icon?name=bi-trash;style.fontSize=2rem"
                    }
                  ],
                  "type": "View?class=flexbox pointer;tooltip.text=erase;style:[height=3rem;width=3rem;borderRadius=1.5rem;transition=.3s];hover.style.backgroundColor=#fff?!new-booking:();!booking-edit-readonly:()"
                },
                {
                  "children": [
                    {
                      "type": "Icon?name=print;google.outlined;style.fontSize=2.2rem"
                    }
                  ],
                  "type": "View?class=flexbox pointer;tooltip.text=print;style.height=3rem;style.width=3rem;style.borderRadius=1.5rem;hover.style.backgroundColor=#fff;style.transition=.2s",
                  "controls": [
                    {
                      "event": "click?():bookings-mini-window.style():[padding=0;transition=null;minHeight=100%;zIndex=99999];next().style().display=none;next().next().style().display=flex;1stChild():bookings-mini-window.style().borderRadius=0;():booking-form-header.style().display=none;():booking-form-footer.style().display=none;#exportPdf():[html=():tickets-mini-window.1stChild().html();name=gen()];print():[id=1stChild():'bookings-mini-window'.id;after-print='next().next().click()']"
                    }
                  ]
                },
                {
                  "type": "View?class=flexbox pointer;tooltip.text=maximize;style.height=3rem;style.width=3rem;style.borderRadius=1.5rem;hover.style.backgroundColor=#fff;style.transition=.2s",
                  "children": [
                    {
                      "type": "Icon?name=aspect_ratio;google.outlined;style.fontSize=2.2rem"
                    }
                  ],
                  "controls": [
                    {
                      "event": "click?style():[id=bookings-mini-window;transition=.2s;padding=0;minHeight=100%];style().display=none;style():next().display=flex;1stChild():bookings-mini-window.style():[borderRadius=0];():booking-form-header.style().display=flex;():booking-form-footer.style().display=flex"
                    }
                  ]
                },
                {
                  "controls": [
                    {
                      "event": "click?style():[id=bookings-mini-window;transition=.2s;padding=10vh 5vw;bottom=0;minHeight=null;zIndex=10];():booking-form-header.style().display=flex;():booking-form-footer.style().display=flex;style().display=none;style():prev().display=flex;style():[1stChild():bookings-mini-window].borderRadius=1rem"
                    }
                  ],
                  "type": "View?class=flexbox pointer;tooltip.text=minimize;style.height=3rem;style.width=3rem;style.borderRadius=1.5rem;hover.style.backgroundColor=#fff;style.transition=.2s;style.display=none",
                  "children": [
                    {
                      "type": "Icon?name=crop;google.outlined;style.fontSize=2.2rem"
                    }
                  ]
                },
                {
                  "children": [
                    {
                      "type": "Icon?name=bi-x-lg;style.color=#000;style.fontSize=1.7rem"
                    }
                  ],
                  "controls": [
                    {
                      "event": "click?style():[id=bookings-mini-window;transition=.2s;padding=10vh 5vw;bottom=0];():bookings-mini-window.style():[opacity=0;pointerEvents=none;padding=10vh 5vw];1stChild():bookings-mini-window.style().borderRadius=1rem;booking-data:().del();new-booking:().del()"
                    }
                  ],
                  "type": "View?class=flexbox pointer;tooltip.text=close;style:[height=3rem;width=3rem;borderRadius=1.5rem;transition=.2s];hover.style.backgroundColor=#fff"
                }
              ]
            }
          ],
          "type": "View?id=booking-form-header;class=flex align-center;style:[width=100%;backgroundColor=#ddd;borderRadius=1rem 1rem 0 0;padding=0.5rem 1rem]"
        },
        {
          "children": [
            {
              "type": "View?class=flexbox;style:[gap=1rem;padding=.75rem 2rem;borderRadius=.5rem;backgroundColor=#ddd]",
              "children": [
                {
                  "type": "Icon?class=pointer;name=account_balance_wallet;tooltip.text=charge agent account;google.outlined;style:[fontSize=2.4rem;color=#888;transition=.2s];hover.style.color=#000;click:[my-voucher:().del();payment-data:()=_map;update():payment-window;():payment-window.style():[opacity=1;pointerEvents=auto]]:[agent:().admin]"
                },
                {
                  "type": "Text?text=Available Balance;style:[fontSize=1.3rem;if():[my-agent:().balance-usd<booking-data:().total-payable-usd]:[color=red]]"
                },
                {
                  "type": "Text?text=my-agent:().balance-usd.round():2.price()+$;style:[fontSize=1.3rem;if():[my-agent:().balance-usd<booking-data:().total-payable-usd]:[color=red]]"
                },
                {
                  "type": "Text?text=Not enough balance!;style:[fontSize=1.3rem;if():[my-agent:().balance-usd<booking-data:().total-payable-usd]:[color=red]]?my-agent:().balance-usd<booking-data:().total-payable-usd"
                }
              ]
            }
          ],
          "type": "View:booking-av-balance?class=flexbox;style:[width=100%]?booking-data:().status=Loading"
        },
        {
          "type": "View:booking-form-body?class=flex column;data=booking-data:();style:[width=100%;gap=2rem;padding=.5rem;marginBottom=2rem]",
          "children": [
            {
              "type": "View?class=flexbox;style:[width=100%;gap=1rem]?agent:().admin;booking-data:().status=Loading;!old-booking:()",
              "children": [
                {
                  "children": [
                    {
                      "type": "Icon?name=manage_accounts;google.outlined;style:[fontSize=2rem;color=#888]"
                    }
                  ],
                  "controls": [
                    {
                      "event": "click:droplist?my-agent:()=agents:().find():[company-name=droplist-txt:()].clone();loader.show;search():[collection=agent;doc=my-agent:().id]:[my-agent:()=search:().data;agents:().replaceItem():[my-agent:().clone()];booking-data:().():[agent=my-agent:().id;agent-name=my-agent:().company-name];update():[booking-agent];update():[booking-av-balance];loader.hide]"
                    }
                  ],
                  "type": "View?class=flexbox pointer;tooltip.text=Change Beneficiary Agency;style:[height=3.5rem;width=3.5rem;borderRadius=.5rem;border=1px solid #ccc;transition=.2s];mouseenter:[style().backgroundColor=#ddd;1stChild().style().color=#444];mouseleave:[style().backgroundColor=#fff;1stChild().style().color=#888];droplist:[items='agents:().():company-name';item.style:[minHeight=3rem;fontSize=1.2rem];preventDefault;align=right]"
                },
                {
                  "children": [
                    {
                      "type": "Icon?name=person_add;google.outlined;style:[fontSize=2rem;color=#888]"
                    }
                  ],
                  "controls": [
                    {
                      "event": "click?style():[id=agent-window;opacity=1;pointerEvents=auto];new-agent:()=true;agent-copied:().del();agent-edit-readonly:()=false;agent-data:()=_map;update():[agent-window]"
                    }
                  ],
                  "type": "View?class=flexbox pointer;tooltip.text=add new agent;style:[height=3.5rem;width=3.5rem;borderRadius=.5rem;border=1px solid #ccc;transition=.2s];mouseenter:[style().backgroundColor=#ddd;1stChild().style().color=#444];mouseleave:[style().backgroundColor=#fff;1stChild().style().color=#888]"
                }
              ]
            },
            {
              "children": [
                {
                  "children": [
                    {
                      "children": [
                        {
                          "type": "Image?src=my-agent:().logo;style:[maxHeight=100%;maxWidth=100%]"
                        }
                      ],
                      "type": "View?class=flex;style:[height=13rem;width=100%]"
                    },
                    {
                      "type": "View?class=flex;style:[gap=1rem;marginLeft=auto]",
                      "children": [
                        {
                          "type": "View?class=vertical;style:[gap=1rem;alignItems=flex-end]",
                          "children": [
                            {
                              "type": "View?class=horizontal;style:[gap=1rem;marginRight=auto]",
                              "children": [
                                {
                                  "type": "Text?text=Travel Agency;style:[color=#000;fontSize=1.4rem;fontWeight=bold;textAlign=left;width=12.5rem]"
                                },
                                {
                                  "type": "Text?text=my-agent:().company-name;style:[color=#000;fontSize=1.4rem;textAlign=left;maxWidth=25rem]"
                                }
                              ]
                            },
                            {
                              "children": [
                                {
                                  "type": "Text?text=Address;style:[color=#000;fontSize=1.4rem;fontWeight=bold;textAlign=left;width=12.5rem]"
                                },
                                {
                                  "type": "Text?text=my-agent:().company-head-office-country+', '+my-agent:().company-head-office-city+', '+my-agent:().company-head-office-address;style:[color=#000;fontSize=1.4rem;textAlign=left;maxWidth=25rem]"
                                }
                              ],
                              "type": "View?class=horizontal;style:[gap=1rem;marginRight=auto]"
                            },
                            {
                              "type": "View?class=horizontal;style:[gap=1rem;marginRight=auto]",
                              "children": [
                                {
                                  "type": "Text?text=Contact Number;style:[color=#000;fontSize=1.4rem;fontWeight=bold;textAlign=left;width=12.5rem]"
                                },
                                {
                                  "type": "Text?text=my-agent:().contact-number;style:[color=#000;fontSize=1.4rem;textAlign=left]"
                                }
                              ]
                            },
                            {
                              "type": "View?class=horizontal;style:[gap=1rem;marginRight=auto]",
                              "children": [
                                {
                                  "type": "Text?text=Email;style:[color=#000;fontSize=1.4rem;fontWeight=bold;textAlign=left;width=12.5rem]"
                                },
                                {
                                  "type": "Text?text=my-agent:().email;style:[color=#000;fontSize=1.4rem;textAlign=left;maxWidth=25rem]"
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ],
                  "type": "View?style:[gap=.5rem;width=100%;display=grid;gridTemplateColumns=1fr 1fr;padding=1rem;height=15rem]?my-agent:()"
                }
              ],
              "type": "View:booking-agent?class=flex column;style.gap=.5rem;style.width=100%"
            },
            {
              "type": "View?class=flex column;style.gap=.5rem;style.width=100%",
              "children": [
                {
                  "type": "Text?class=flex;text=Registration Info;style:[width=100%;borderBottom=1px solid #ddd;fontSize=1.4rem;padding=1rem 0]"
                },
                {
                  "type": "View?style:[gap=1rem;width=100%;display=grid;gridTemplateColumns=1fr 1.5fr 1fr .75fr .75fr .75fr;padding=1rem]",
                  "children": [
                    {
                      "type": "Entry?label:[text=Registration Id;location=outside;style.fontSize=1.3rem];readonly;copyable;path=id;clicked.style.border=2px solid #0080ff;style:[width=100%;height=3.5rem;borderRadius=.5rem;fontSize=1.3rem]"
                    },
                    {
                      "type": "Input?label:[text=Creation Date;location=outside;style.fontSize=1.3rem];readonly;input.value=data().creation-date.toSimplifiedDateTime();tooltip.text=data().creation-date.toSimplifiedDateTime();clicked.style.border=2px solid #0080ff;style:[width=100%;height=3.5rem;borderRadius=.5rem;fontSize=1.3rem]"
                    },
                    {
                      "type": "Input?label:[text=Created By;location=outside;style.fontSize=1.3rem];readonly;path=user-name;clicked.style.border=2px solid #0080ff;style:[width=100%;height=3.5rem;borderRadius=.5rem;fontSize=1.3rem]"
                    },
                    {
                      "type": "Input?id=booking-active;label:[text=Active;location=outside;style.fontSize=1.3rem];readonly;path=active;clicked.style.border=2px solid #0080ff;style:[width=100%;height=3.5rem;borderRadius=.5rem;fontSize=1.3rem];input.value=if():data():Active:Inactive;if():[!booking-edit-readonly:()]:[droplist.items=_array:Active:Inactive;if():[booking-edit-readonly:()]:[droplist.readonly=true];droplist.item.style.fontSize=1.3rem;droplist.preventDefault]",
                      "controls": [
                        {
                          "event": "click:droplist?if():[droplist-txt:()=Active]:[booking-data:().active=true;txt()=Active]:[booking-data:().active=false;txt()=Inactive]?!booking-edit-readonly:()"
                        }
                      ]
                    },
                    {
                      "type": "Input?id=booking-status;label:[text=Status;location=outside;style.fontSize=1.3rem];readonly;path=status;clicked.style.border=2px solid #0080ff;style:[width=100%;height=3.5rem;borderRadius=.5rem;fontSize=1.3rem];if():[booking-edit-readonly:()]:[readonly=true]"
                    },
                    {
                      "type": "Input?label:[text=PNR;location=outside;style.fontSize=1.3rem];readonly;container.style.display=none;copyable;if():[!data().pnr]:[data().pnr=gen():6.touppercase()];path=pnr;clicked.style.border=2px solid #0080ff;style:[width=100%;height=3.5rem;borderRadius=.5rem;fontSize=1.3rem]"
                    }
                  ]
                }
              ]
            },
            {
              "children": [
                {
                  "type": "Text?class=flex;text=Flight Info;style:[width=100%;borderBottom=1px solid #ddd;fontSize=1.4rem;padding=1rem 0]"
                },
                {
                  "type": "View?style:[gap=1rem;width=100%;display=grid;gridTemplateColumns=1.5fr 1.25fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr;padding=1rem]",
                  "children": [
                    {
                      "children": [
                        {
                          "type": "Text?class=pointer;text=Airline;style:[color=#888;fontSize=1.3rem;transition=.3s];hover.style.color=#444"
                        }
                      ],
                      "type": "View?class=flex align-center;style:[height=100%;flex=1]"
                    },
                    {
                      "children": [
                        {
                          "type": "Text?class=pointer;text=Travel Date;style:[color=#888;fontSize=1.3rem;transition=.3s];hover.style.color=#444"
                        }
                      ],
                      "type": "View?class=flex align-center;style:[height=100%;flex=1]"
                    },
                    {
                      "children": [
                        {
                          "type": "Text?class=pointer;text=Flight No.;style:[color=#888;fontSize=1.3rem;transition=.3s];hover.style.color=#444"
                        }
                      ],
                      "type": "View?class=flex align-center;style:[height=100%;flex=1]"
                    },
                    {
                      "type": "View?class=flex align-center;style:[height=100%;flex=1]",
                      "children": [
                        {
                          "type": "Text?class=pointer;text=From;style:[color=#888;fontSize=1.3rem;transition=.3s];hover.style.color=#444"
                        }
                      ]
                    },
                    {
                      "type": "View?class=flex align-center;style:[height=100%;flex=1]",
                      "children": [
                        {
                          "type": "Text?class=pointer;text=To;style:[color=#888;fontSize=1.3rem;transition=.3s];hover.style.color=#444"
                        }
                      ]
                    },
                    {
                      "children": [
                        {
                          "type": "Text?class=pointer;text=Dep;style:[color=#888;fontSize=1.3rem;transition=.3s];hover.style.color=#444"
                        }
                      ],
                      "type": "View?class=flex align-center;style:[height=100%;flex=1]"
                    },
                    {
                      "children": [
                        {
                          "type": "Text?class=pointer;text=Arr;style:[color=#888;fontSize=1.3rem;transition=.3s];hover.style.color=#444"
                        }
                      ],
                      "type": "View?class=flex align-center;style:[height=100%;flex=1]"
                    },
                    {
                      "children": [
                        {
                          "type": "Text?class=pointer;text=Stops;style:[color=#888;fontSize=1.3rem;transition=.3s];hover.style.color=#444"
                        }
                      ],
                      "type": "View?class=flex align-center;style:[height=100%;flex=1]"
                    },
                    {
                      "children": [
                        {
                          "type": "Text?class=pointer;text=Aircraft;style:[color=#888;fontSize=1.3rem;transition=.3s];hover.style.color=#444"
                        }
                      ],
                      "type": "View?class=flex align-center;style:[height=100%;flex=1]"
                    },
                    {
                      "children": [
                        {
                          "type": "Text?class=pointer;text=Duration;style:[color=#888;fontSize=1.3rem;transition=.3s];hover.style.color=#444"
                        }
                      ],
                      "type": "View?class=flex align-center;style:[height=100%;flex=1]"
                    }
                  ]
                },
                {
                  "children": [
                    {
                      "type": "View?class=flex align-center;style:[height=100%;flex=1;gap=1rem]",
                      "children": [
                        {
                          "type": "Image?class=flexbox;src=collections:().airlines.airlines.find():[code=data().airline.slice():0:2].image-url;style:[maxWidth=4rem;maxHeight=6rem]"
                        },
                        {
                          "type": "Text?class=flex;text=data().airline.slice():3;style:[fontSize=1.3rem]"
                        }
                      ]
                    },
                    {
                      "children": [
                        {
                          "type": "Text?class=flex;text=data().departure-day.toDateFormat();style:[fontSize=1.3rem]"
                        }
                      ],
                      "type": "View?class=flex align-center;style:[height=100%;flex=1]"
                    },
                    {
                      "type": "View?class=flex align-center;style:[height=100%;flex=1]",
                      "children": [
                        {
                          "type": "Text?class=flex align-center;text=data().flight-number;style:[fontSize=1.3rem]"
                        }
                      ]
                    },
                    {
                      "type": "View?class=flex align-center;style:[height=100%;flex=1]",
                      "children": [
                        {
                          "type": "Text?class=flex align-center;text=data().departure-airport.split(): .0;style:[fontSize=1.3rem]"
                        }
                      ]
                    },
                    {
                      "type": "View?class=flex align-center;style:[height=100%;flex=1]",
                      "children": [
                        {
                          "type": "Text?class=flex align-center;text=data().arrival-airport.split(): .0;style:[fontSize=1.3rem]"
                        }
                      ]
                    },
                    {
                      "children": [
                        {
                          "type": "Text?class=flex align-center;text=data().departure-time.toClock():[hr;min];style:[fontSize=1.3rem]"
                        }
                      ],
                      "type": "View?class=flex align-center;style:[height=100%;flex=1]"
                    },
                    {
                      "children": [
                        {
                          "type": "Text?class=flex align-center;text=data().arrival-time.toClock():[hr;min]+if():[data().departure-day<data().arrival-day]:' (+1)':'';style:[fontSize=1.3rem]"
                        }
                      ],
                      "type": "View?class=flex align-center;style:[height=100%;flex=1]"
                    },
                    {
                      "children": [
                        {
                          "type": "Text?class=flexbox;text=data().stops;style:[fontSize=1.3rem]"
                        }
                      ],
                      "type": "View?class=flex align-center;style:[height=100%;flex=1]"
                    },
                    {
                      "type": "View?class=flex align-center;style:[height=100%;flex=1]",
                      "children": [
                        {
                          "type": "Text?class=flexbox;text=data().aircraft;style:[fontSize=1.3rem]"
                        }
                      ]
                    },
                    {
                      "children": [
                        {
                          "type": "Text?class=flexbox;text=data().flight-duration.split():':'.0+'h'+':'+data().flight-duration.split():':'.1+'m';style:[fontSize=1.3rem]?data().flight-duration"
                        }
                      ],
                      "type": "View?class=flex align-center;style:[height=100%;flex=1]"
                    }
                  ],
                  "type": "[View]?path=booking-details;style:[gap=1rem;width=100%;display=grid;gridTemplateColumns=1.5fr 1.25fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr;padding=1rem]"
                }
              ],
              "type": "View?class=flex column;style.gap=.5rem;style.width=100%"
            },
            {
              "type": "View?view=booking-seat-passenger"
            },
            {
              "type": "View:total-pricing-booking?class=flex column;style.gap=.5rem;style.width=100%;style.padding=2rem",
              "children": [
                {
                  "type": "Text?class=flex;text=Pricing Info;style:[width=100%;borderBottom=1px solid #ddd;fontSize=1.4rem;padding=1rem 0]?false"
                },
                {
                  "children": [
                    {
                      "type": "View?class=flex align-center;style:[height=100%;flex=1]",
                      "children": [
                        {
                          "type": "Text?class=pointer;text=;style:[color=#888;fontSize=1.3rem;transition=.3s];hover.style.color=#444"
                        }
                      ]
                    },
                    {
                      "type": "View?class=flex align-center;style:[height=100%;flex=1]",
                      "children": [
                        {
                          "type": "Text?class=pointer;text=;style:[color=#888;fontSize=1.3rem;transition=.3s];hover.style.color=#444"
                        }
                      ]
                    },
                    {
                      "type": "View?class=flex align-center;style:[height=100%;flex=1]",
                      "children": [
                        {
                          "type": "Text?class=pointer;text=;style:[color=#888;fontSize=1.3rem;transition=.3s];hover.style.color=#444"
                        }
                      ]
                    },
                    {
                      "children": [
                        {
                          "type": "Text?class=pointer;text=;style:[color=#888;fontSize=1.3rem;transition=.3s];hover.style.color=#444"
                        }
                      ],
                      "type": "View?class=flex align-center;style:[height=100%;flex=1]"
                    },
                    {
                      "children": [
                        {
                          "type": "Text?class=pointer;text=;style:[color=#888;fontSize=1.3rem;transition=.3s];hover.style.color=#444"
                        }
                      ],
                      "type": "View?class=flex align-center;style:[height=100%;flex=1]"
                    },
                    {
                      "children": [
                        {
                          "type": "Text?class=pointer;text=Base Fare;style:[color=#888;fontSize=1.3rem;transition=.3s;marginLeft=auto];hover.style.color=#444"
                        }
                      ],
                      "type": "View?class=flex align-center;style:[height=100%;flex=1]"
                    },
                    {
                      "type": "View?class=flex align-center;style:[height=100%;flex=1]",
                      "children": [
                        {
                          "type": "Text?class=pointer;text=Taxes;style:[color=#888;fontSize=1.3rem;transition=.3s;marginLeft=auto];hover.style.color=#444"
                        }
                      ]
                    },
                    {
                      "type": "View?class=flex align-center;style:[height=100%;flex=1]",
                      "children": [
                        {
                          "type": "Text?class=pointer;text=Fees;style:[color=#888;fontSize=1.3rem;transition=.3s;marginLeft=auto];hover.style.color=#444"
                        }
                      ]
                    },
                    {
                      "children": [
                        {
                          "type": "Text?class=pointer;text=Commission;style:[color=#888;fontSize=1.3rem;transition=.3s;marginLeft=auto];hover.style.color=#444"
                        }
                      ],
                      "type": "View?class=flex align-center;style:[height=100%;flex=1]?!agent:().admin"
                    },
                    {
                      "children": [
                        {
                          "type": "Text?class=pointer;text=Service Fees;style:[color=#888;fontSize=1.3rem;transition=.3s;marginLeft=auto];hover.style.color=#444"
                        }
                      ],
                      "type": "View?class=flex align-center;style:[height=100%;flex=1]"
                    },
                    {
                      "children": [
                        {
                          "type": "Text?class=pointer;text=Payable;style:[color=#888;fontSize=1.3rem;transition=.3s;marginLeft=auto];hover.style.color=#444"
                        }
                      ],
                      "type": "View?class=flex align-center;style:[height=100%;flex=1]"
                    }
                  ],
                  "type": "View?style:[gap=1rem;width=100%;display=grid;gridTemplateColumns=if():[!agent:().admin]:[1fr 1fr .5fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr]:[1fr 1fr .5fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr];borderRadius=.5rem;marginBottom=1rem]"
                },
                {
                  "type": "View?style:[gap=1rem;height=3.5rem;width=100%;display=grid;gridTemplateColumns=if():[!agent:().admin]:[1fr 1fr .5fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr]:[1fr 1fr .5fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr];borderRadius=.5rem;borderTop=1px solid #ddd]",
                  "children": [
                    {
                      "type": "Text?text=Total (usd);class=flex align-center;style:[height=100%;flex=1;fontSize=1.3rem]"
                    },
                    {
                      "type": "View?class=flex align-center;style:[height=100%;flex=1]"
                    },
                    {
                      "type": "View?class=flex align-center;style:[height=100%;flex=1]"
                    },
                    {
                      "type": "View?class=flex align-center;style:[height=100%;flex=1]"
                    },
                    {
                      "type": "View?class=flex align-center;style:[height=100%;flex=1]"
                    },
                    {
                      "type": "View?class=flex align-center;style:[height=100%;flex=1]",
                      "children": [
                        {
                          "type": "Text?class=pointer;text=data().total-base-fare-usd.round():2+'$';style:[color=#000;fontSize=1.3rem;transition=.3s;marginLeft=auto];hover.style.color=#444"
                        }
                      ]
                    },
                    {
                      "type": "View?class=flex align-center;style:[height=100%;flex=1]",
                      "children": [
                        {
                          "type": "Text?class=pointer;text=data().total-taxes-usd.round():2+'$';style:[color=#000;fontSize=1.3rem;transition=.3s;marginLeft=auto];hover.style.color=#444"
                        }
                      ]
                    },
                    {
                      "children": [
                        {
                          "type": "Text?class=pointer;text=data().total-fees-usd.round():2+'$';style:[color=#000;fontSize=1.3rem;transition=.3s;marginLeft=auto];hover.style.color=#444"
                        }
                      ],
                      "type": "View?class=flex align-center;style:[height=100%;flex=1]"
                    },
                    {
                      "type": "View?class=flex align-center;style:[height=100%;flex=1]?!agent:().admin",
                      "children": [
                        {
                          "type": "Text?class=pointer;text=data().total-commission-usd.round():2+'$';style:[color=#000;fontSize=1.3rem;transition=.3s;marginLeft=auto];hover.style.color=#444"
                        }
                      ]
                    },
                    {
                      "children": [
                        {
                          "type": "Text?class=pointer;text=data().total-additional-profit-usd.round():2+'$';style:[color=#000;fontSize=1.3rem;transition=.3s;marginLeft=auto];hover.style.color=#444"
                        }
                      ],
                      "type": "View?class=flex align-center;style:[height=100%;flex=1]"
                    },
                    {
                      "children": [
                        {
                          "type": "Text?class=pointer;text=[data().total-payable-usd+data().total-additional-profit-usd].round():2+$;style:[color=#000;fontSize=1.3rem;transition=.3s;marginLeft=auto];hover.style.color=#444"
                        }
                      ],
                      "type": "View?class=flex align-center;style:[height=100%;flex=1]"
                    }
                  ]
                }
              ]
            },
            {
              "children": [
                {
                  "type": "Input?textarea;label:[text=Notes;location=outside;style.fontSize=1.3rem];path=note;if():[booking-edit-readonly:()]:readonly;clicked.style.border=2px solid #0080ff;style:[width=100%;height=10rem;borderRadius=.5rem;fontSize=1.3rem]"
                }
              ],
              "type": "View?class=grid column;style:[gap=.5rem;width=100%;padding=2rem;gridTemplateColumns=1fr 1fr 1fr;gap=1rem]"
            }
          ]
        },
        {
          "type": "View:booking-form-footer?class=flexbox;style:[width=100%;borderTop=1px solid #ddd;padding=2rem;justifyContent=flex-end;gap=1rem;marginTop=2rem;marginBottom=-1rem;position=relative]",
          "children": [
            {
              "children": [
                {
                  "type": "View?class=flexbox;style:[marginLeft=auto;gap=1rem]",
                  "children": [
                    {
                      "controls": [
                        {
                          "event": "click?checked()=checked().opp();1stChild().style().opacity=if():checked():1:0;if():checked():[booking-data:().accept-terms-and-conditions=true]:[booking-data:().accept-terms-and-conditions=false]?booking-data:().status=Loading;!old-booking:()"
                        }
                      ],
                      "type": "View?class=flexbox pointer;style:[position=relative;borderRadius=.5rem;border=1px solid #aaa;height=1.75rem;width=1.75rem;backgroundColor=#fff];booking-data:().accept-terms-and-conditions=booking-data:().accept-terms-and-conditions||false;checked=booking-data:().accept-terms-and-conditions",
                      "children": [
                        {
                          "type": "Icon?name=bi-check2;style:[color=blue;fontSize=2.4rem;position=absolute;opacity=if():[parent().checked]:1:0;transition=.3s;left=-.1rem;bottom=-.2rem]"
                        }
                      ]
                    },
                    {
                      "children": [
                        {
                          "type": "Text?text=I agree to the;style:[fontSize=1.2rem]"
                        },
                        {
                          "type": "Text?link.path='/terms-and-conditions';text=Terms & Conditions;style:[color=blue;fontSize=1.2rem;color=blue]"
                        }
                      ],
                      "type": "View?class=flexbox;style:[gap=.25rem]"
                    }
                  ]
                }
              ],
              "type": "View?class=flexbox;style:[position=absolute;left=0;gap=1rem;padding=0 2rem]"
            },
            {
              "type": "Text?class=flexbox pointer;text=if():[old-booking:()]:Reissue:Issue;style:[height=3rem;borderRadius=1.5rem;width=10rem;color=#fff;if():[old-booking:()]:[backgroundImage=linear-gradient(to right, green, red)]:[backgroundColor=green];fontSize=1.3rem;opacity=0.8;transition=.3s];hover.style.opacity=1?if():[!old-booking:()]:[!booking-edit-readonly:()]:true;booking-data:().status=Booked||booking-data:().status=Loading",
              "controls": [
                {
                  "event": "click?loader.show;search():[collection=agent;doc=booking-data:().agent]:[my-agent:()=search:().data;if():[my-agent:().balance-usd>booking-data:().total-payable-usd||my-agent:().balance-usd=booking-data:().total-payable-usd]:[bookings:().pullItem():[id=booking-data:().id];new-booking:().del();booking-data:().():[history=_list:[_map:user:[user:().id]:user-name:[user:().username]:agent:[agent:().id]:agent-name:[agent:().company-name]:description:['New booking has been issued.']:status:Confirmed:date:[today().timestamp()]];#names=booking-data:().booking-details.clone().0.seats.():[passengers-details.():[first-name+ +last-name]].flat().join(): +if():[booking-data:().booking-details.clone().0.seats.():[passengers-details.():[infants].flat().filter()].flat().filter().len()>0]:[ +booking-data:().booking-details.clone().0.seats.():[passengers-details.():[infants.():[first-name+ +last-name]].flat().filter()].flat().filter().join(): ];issuing-day=todayStart();issuing-month=monthStart();issuing-year=yearStart();issued-by=user:().id;issued-by-name=user:().username;issued-by-agent=agent:().id;issued-by-agent-name=agent:().company-name;status=Issued;issue-date=today().timestamp();flights=my-flights:().():id;travel-date=my-flights:().0.departure-day;go-departure-airport=my-flights:().0.departure-airport;go-departure-time=my-flights:().0.departure-time;go-arrival-airport=my-flights:().0.arrival-airport;go-arrival-time=my-flights:().0.arrival-time;start-balance-usd=my-agent:().balance-usd;end-balance-usd=[my-agent:().balance-usd]-[booking-data:().total-payable-usd];my-agent:().buyings-usd=[my-agent:().buyings-usd||0]+[booking-data:().total-payable-usd];setAgentBuyingsBookings();if():[my-flights:().len()=2]:[return-date=my-flights:().1.departure-day;return-departure-airport=my-flights:().1.departure-airport;return-departure-time=my-flights:().1.departure-time;return-arrival-airport=my-flights:().1.arrival-airport;return-arrival-time=my-flights:().1.arrival-time]];search():[collection=collection;doc=counter]:[collections:().counter=().search.data;if():[!booking-edit:()]:[booking-data:().booking-details._():[my-flights:().find():[id=_.flight-id]._():[_.total-av-seats=[_.total-av-seats||_.total-seats]-[__.total-seats];__.seats._():[__.seats.find():[sub-class=_.class]._():[_.av-seats=[_.av-seats]-[__.total-seats]]]]]];().reservations-details=booking-data:().clone().booking-details._():[_.seats._():[_.passengers-details.():[id=[gen():20];pnr=booking-data:().pnr;booking=booking-data:().id;status=Issued;type=booking-data:().type;flight-number=__.flight-number;flight-id=__.flight-id;departure-airport=__.departure-airport;arrival-airport=__.arrival-airport;departure-day=__.departure-day;arrival-day=__.arrival-day;departure-time=__.departure-time;arrival-time=__.arrival-time;aircraft=__.aircraft;airline=__.airline;flight-duration=__.flight-duration;flight-type=__.flight-type;stops=__.stops;booking-policy=_.booking-policy;change-policy=_.change-policy;cancelation-policy=_.cancelation-policy;class=_.class;head-class=_.head-class;baggage-kg=_.baggage-kg;meal-included=_.meal-included;terms-and-conditions=__.terms-and-conditions;if():[infants.len()>0]:[_.'passengers-details'.push():[infants.clone().():[id=[gen():20];pnr=booking-data:().pnr;status=Issued;type=booking-data:().type;flight-number=__.flight-number;flight-id=__.flight-id;departure-airport=__.departure-airport;arrival-airport=__.arrival-airport;departure-day=__.departure-day;arrival-day=__.arrival-day;departure-time=__.departure-time;arrival-time=__.arrival-time;aircraft=__.aircraft;airline=__.airline;flight-duration=__.flight-duration;flight-type=__.flight-type;stops=__.stops;booking-policy=_.booking-policy;change-policy=_.change-policy;cancelation-policy=_.cancelation-policy;class=_.class;head-class=_.head-class;baggage-kg=_.baggage-kg;meal-included=_.meal-included;terms-and-conditions=__.terms-and-conditions]]]]]].():[seats.():passengers-details.flat()].flat();my-reservations:()=_list;().my-counters=_list;().reservations-details._():[if():[!_.counter.in():[().my-counters]]:[().my-counters.push():[_.counter];if():[user:().username!=test]:[collections:().counter.e-ticket=counter():[collections:().counter.e-ticket]];my-reservations:().push():[_map:history:[_list:[_map:user:[user:().id]:user-name:[user:().username]:agent:[agent:().id]:agent-name:[agent:().company-name]:description:['New ticket has been issued.']:status:Confirmed:date:[today().timestamp()]]]:id:[gen():20]:pnr:[booking-data:().pnr]:e-ticket:[collections:().counter.e-ticket.counter]:creation-date:[today().timestamp()]:day:todayStart():month:monthStart():year:yearStart():status:Confirmed:user:[booking-data:().user]:user-name:[booking-data:().user-name]:issued-by:[user:().id]:issued-by-name:[user:().username]:agent:[booking-data:().agent]:agent-name:[booking-data:().agent-name]:issued-by-agent:[booking-data:().agent]:issued-by-agent-name:[booking-data:().agent-name]:type:[booking-data:().type]:flights:[my-flights:().():id]:travel-date:[my-flights:().0.departure-day]:go-departure-airport:[my-flights:().0.departure-airport]:go-departure-time:[my-flights:().0.departure-time]:go-arrival-airport:[my-flights:().0.arrival-airport]:go-arrival-time:[my-flights:().0.arrival-time]:return-date:[my-flights:().1.departure-day]:return-departure-airport:[my-flights:().1.departure-airport]:return-departure-time:[my-flights:().1.departure-time]:return-arrival-airport:[my-flights:().1.arrival-airport]:return-arrival-time:[my-flights:().1.arrival-time]:booking:[booking-data:().id]:reservation-details:[().reservations-details.filter():[counter=_.counter]]]]];my-reservations:()._():[if():[_.reservation-details.0.parent-counter]:[_.parent-e-ticket=my-reservations:().find():[reservation-details.0.counter=_.reservation-details.0.parent-counter].e-ticket;_.parent-reservation=my-reservations:().find():[reservation-details.0.counter=_.reservation-details.0.parent-counter].id];_.total-base-fare-usd=_.reservation-details.():base-fare-usd.sum();_.total-taxes-usd=_.reservation-details.():taxes-usd.sum();_.total-fees-usd=_.reservation-details.():fees-usd.sum();_.total-additional-profit-usd=_.reservation-details.():additional-profit-usd.sum();_.total-commission-usd=_.reservation-details.():commission-usd.sum();_.total-usd=_.reservation-details.():total-usd.sum();_.total-payable-usd=_.reservation-details.():payable-usd.sum()];booking-data:().booking-details._():[my-flight-invoices:().find():[flight-id=_.flight-id]._():[_.bookings.push():[booking-data:().id];_.pnrs.push():[booking-data:().pnr];_.reservations.push():[my-reservations:().():id];_.tickets.push():[my-reservations:().():e-ticket];_.total-av-seats=[_.total-av-seats||_.total-seats]-[__.total-seats];__.seats._():[__.seats.find():[sub-class=_.class]._():[_.av-seats=[_.av-seats]-[__.total-seats]]];_.total-reserved-base-fare-usd=[_.total-reserved-base-fare-usd||0]+[__.total-base-fare-usd];_.total-reserved-taxes-usd=[_.total-reserved-taxes-usd||0]+[__.total-taxes-usd];_.total-reserved-fees-usd=[_.total-reserved-fees-usd||0]+[__.total-fees-usd];_.total-reserved-additional-profit-usd=[_.total-reserved-additional-profit-usd||0]+[__.total-additional-profit-usd];_.total-reserved-usd=[_.total-reserved-usd||0]+[__.total-usd];_.total-reserved-commission-usd=[_.total-reserved-commission-usd||0]+[__.total-commission-usd];_.total-reserved-payable-usd=[_.total-reserved-payable-usd||0]+[__.total-payable-usd];_.total-reserved-seats=[_.total-reserved-seats||0]+[__.total-seats];_.total-reserved-passengers=[_.total-reserved-passengers||0]+[__.total-passengers];__.seats._():[__.seats.find():[sub-class=_.class]._():[_.total-reserved-base-fare-usd=[_.total-reserved-base-fare-usd||0]+[__.total-base-fare-usd];_.total-reserved-taxes-usd=[_.total-reserved-taxes-usd||0]+[__.total-taxes-usd];_.total-reserved-fees-usd=[_.total-reserved-fees-usd||0]+[__.total-fees-usd];_.total-reserved-additional-profit-usd=[_.total-reserved-additional-profit-usd||0]+[__.total-additional-profit-usd];_.total-reserved-usd=[_.total-reserved-usd||0]+[__.total-usd];_.total-reserved-commission-usd=[_.total-reserved-commission-usd||0]+[__.total-commission-usd];_.total-reserved-payable-usd=[_.total-reserved-payable-usd||0]+[__.total-payable-usd];_.total-reserved-seats=[_.total-reserved-seats||0]+[__.total-seats];_.total-reserved-passengers=[_.total-reserved-passengers||0]+[__.total-passengers]]]]];my-reservations:()._():[_.reservation-details.():[e-ticket=_.e-ticket;pnr=_.pnr]];my-reservations:()._():[_.start-balance-usd=my-agent:().balance-usd;_.end-balance-usd=[my-agent:().balance-usd||0]-[_.total-payable-usd];_.reservation-details._():[_.start-balance-usd=my-agent:().balance-usd;my-agent:().balance-usd=[my-agent:().balance-usd||0]-[_.payable-usd];_.end-balance-usd=my-agent:().balance-usd]];booking-data:().reservations=my-reservations:().():id;booking-data:().tickets=my-reservations:().():e-ticket;booking-data:().booking-details.():[seats.():[passengers-details.():[status=Issued];status=Issued];status=Issued];my-agent:().bookings=[my-agent:().bookings||0]+1;save():[collection=agent;data=my-agent:().clone()]:[my-agent:().del()];save():[collection=flight-booking;data=booking-data:()]:[booking-data:().del()];save():[collection=flight-reservation;data=my-reservations:()]:[my-reservations:()=_list];save():[collection=collection;doc=counter;data=collections:().counter];save():[collection=flight-invoice;data=my-flight-invoices:()]:[my-flight-invoices:()=_list];save():[collection=flight;data=my-flights:()]:[my-flights:()=_list];if():[booking-edit:()]:[update():bookings-list];update():pricing-bar;():book-a-flight-list.children().():rem();():flight-booking-sidebar-btn.click();timer():[bookings:()=_list:[booking-data:().clone()];update():[bookings-list];next().next().click();booking-edit:().del();note():[text=Tickets issued successfully!];loader.hide]:200]]:[note():[text=Not enough balance in your account!;type=danger];loader.hide]]?!old-booking:();booking-data:().accept-terms-and-conditions;!booking-data:().booking-details.find():[seats.find():[passengers-details.find():[!last-name||!first-name||if():[infants.len()>0]:[infants.find():[!last-name||!first-name]]:false]]];booking-data:().booking-details.0.total-infants=booking-data:().booking-details.0.seats.():[passengers-details.():infants.filter().flat()].flat().len()"
                },
                {
                  "event": "click?loader.show;issueBookingReissue()?old-booking:()"
                },
                {
                  "event": "click?note():[text='You have '+[[booking-data:().booking-details.0.total-infants]-[booking-data:().booking-details.0.seats.():[passengers-details.():infants.flat()].flat().len()]]+' remaining unadded infant!';type=danger]?booking-data:().booking-details.0.total-infants.len()>0;booking-data:().booking-details.0.total-infants!=booking-data:().booking-details.0.seats.():[passengers-details.():infants.flat()].flat().len()"
                },
                {
                  "event": "click?note():[text=Check I agree to the terms and conditions to continue!;type=danger]?!booking-data:().accept-terms-and-conditions"
                },
                {
                  "event": "click?note():[text=Kindly fill all required info!;type=danger]?booking-data:().accept-terms-and-conditions;booking-data:().booking-details.find():[seats.find():[passengers-details.find():[!last-name||!first-name]]]"
                }
              ]
            },
            {
              "type": "Text?class=flexbox pointer;text=Split;tooltip.text=split selected;style:[height=3rem;borderRadius=1.5rem;width=10rem;color=#fff;backgroundColor=#f202ca;fontSize=1.3rem;opacity=0.8;transition=.3s];hover.style.opacity=1?user:().admin;agent:().admin;booking-data:().status=Booked||booking-data:().status=Issued;booking-data:().total-seats>1",
              "controls": [
                {
                  "event": "click?loader.show;new-booking:().del();bookings:().pullItem():[id=booking-data:().id];splited-data=className():passenger-checker.filter():checked.():data().clone();counters=_list;splited-data._():[().counters.push():[_.counter];_.infants._():[().counter.push():[_.counter]]];new-booking-data:()=booking-data:().clone();new-booking-data:().booking-details.():[seats._():[_.[passengers-details].pullItems():[!counter.in():[().counters]]].pullItems():[passengers-details.len()=0]];booking-data:().booking-details.():[seats._():[_.[passengers-details].pullItems():[counter.in():[().counters]]].pullItems():[passengers-details.len()=0]];updateBookingDataSplit();updateNewBookingDataSplit();updateTicketsDataSplit()?booking-data:().accept-terms-and-conditions;className():passenger-checker.find():[checked=true];booking-data:().total-seats>1;booking-data:().status=Issued"
                },
                {
                  "event": "click?note():[text=Select Passengers you want to split!;type=warning]?booking-data:().accept-terms-and-conditions;!className():passenger-checker.find():[checked=true];booking-data:().total-seats>1;booking-data:().status=Issued"
                }
              ]
            },
            {
              "controls": [
                {
                  "event": "click?loader.show;booking-data:().():[history=[booking-data:().history||_list].list();history.push():[_map:user:[user:().id]:user-name:[user:().username]:agent:[agent:().id]:agent-name:[agent:().company-name]:description:['Booking has been edited.']:status:Confirmed:date:[today().timestamp()]];lastEdit-day=todayStart();lastEdit-month=monthStart();lastEdit-year=yearStart();lastEdited-by=user:().id;lastEdited-by-name=user:().username;lastEdited-by-agent=agent:().id;lastEdited-by-agent-name=agent:().company-name;lastEdited-date=today().timestamp()];save():[collection=flight-booking;data=booking-data:()]:[booking-data:()=().save.data;note():[text=Booking has been edited!];bookings:().replaceItem():[booking-data:().clone()];booking-data:().del();booking-edit:().del();update():'bookings-list';loader.hide;next().click()]?booking-data:().accept-terms-and-conditions;booking-data:().status=Booked"
                },
                {
                  "event": "click?loader.show;booking-data:().():[lastEdit-day=todayStart();lastEdit-month=monthStart();lastEdit-year=yearStart();lastEdited-by=user:().id;lastEdited-by-name=user:().username;lastEdited-by-agent=agent:().id;lastEdited-by-agent-name=agent:().company-name;status=Issued;lastEdited-date=today().timestamp()];search():[collection=flight-reservation;docs=booking-data:().reservations]:[my-reservations:()=search:().data.values();().my-reservations=_list;booking-data:().clone().booking-details.0.seats.():[passengers-details].flat()._push():[_.():infants.filter()].flat()._():[my-reservations:().find():[reservation-details.0.counter=_.counter].():[lastEdit-date=today().timestamp();lastEdit-day=todayStart();lastEdit-month=monthStart();lastEdit-year=yearStart();lastEdited-by=user:().id;lastEdited-by-name=user:().username;lastEdited-by-agent=agent:().id;lastEdited-by-agent-name=agent:().company-name;reservation-details.():[title=_.title;gender=_.gender;first-name=_.first-name;last-name=_.last-name;dob=_.dob;nationality=_.nationality;passport-number=_.passport-number;passport-issuer=_.passport-issuer;passport-expiry-date=_.passport-expiry-date;contact-number=_.contact-number;email=_.email;if():[infants]:[infants=_.infants]]]];save():[collection=flight-reservation;data=my-reservations:()];save():[collection=flight-booking;data=booking-data:()];bookings:().replaceItem():[booking-data:().clone()];booking-data:().del();booking-edit:().del();update():'bookings-list';note():[text=Edits saved successfully!];next().click();loader.hide]?booking-data:().accept-terms-and-conditions;!booking-data:().clone().booking-details.find():[seats.find():[passengers-details.find():[!last-name||!first-name||if():[infants.len()>0]:[infants.find():[!first-name||!last-name]]:false]]];booking-data:().status=Issued"
                },
                {
                  "event": "click?note():[text=Check I agree to the terms and conditions to continue!;type=danger]?!booking-data:().accept-terms-and-conditions"
                }
              ],
              "type": "Text?id=book-seats-btn;class=flexbox pointer;text=Save;style:[height=3rem;borderRadius=1.5rem;width=10rem;color=#fff;backgroundColor=blue;fontSize=1.3rem;opacity=0.8;transition=.3s];hover.style.opacity=1?!booking-edit-readonly:();booking-data:().status=Booked||booking-data:().status=Issued"
            },
            {
              "controls": [
                {
                  "event": "click?note():[text=Check terms and conditions to continue!;type=danger]?!booking-data:().accept-terms-and-conditions"
                },
                {
                  "event": "click?loader.show;new-booking:().del();booking-data:().():[history=[booking-data:().history||_list].list();history.push():[_map:user:[user:().id]:user-name:[user:().username]:agent:[agent:().id]:agent-name:[agent:().company-name]:description:['New booking has been booked.']:status:Confirmed:date:[today().timestamp()]];booking-day=todayStart();booking-month=monthStart();booking-year=yearStart();booked-by=user:().id;booked-by-name=user:().username;booked-by-agent=agent:().id;booked-by-agent-name=agent:().company-name;status=Booked;booking-date=today().timestamp();flights=my-flights:().():id.clone();travel-date=my-flights:().0.departure-day;go-departure-airport=my-flights:().0.departure-airport;go-departure-time=my-flights:().0.departure-time;go-arrival-airport=my-flights:().0.arrival-airport;go-arrival-time=my-flights:().0.arrival-time;if():[my-flights:().len()=2]:[return-date=my-flights:().1.departure-day;return-departure-airport=my-flights:().1.departure-airport;return-departure-time=my-flights:().1.departure-time;return-arrival-airport=my-flights:().1.arrival-airport;return-arrival-time=my-flights:().1.arrival-time]];booking-data:().booking-details._():[my-flights:().find():[id=_.flight-id]._():[_.total-av-seats=[_.total-av-seats||_.total-seats]-[__.total-seats];__.seats._():[__.seats.find():[sub-class=_.class]._():[_.av-seats=[_.av-seats]-[__.total-seats]]]];my-flight-invoices:().find():[flight-id=_.flight-id]._():[_.pnrs.push():[booking-data:().pnr];_.open-bookings=[_.open-bookings||_list];_.open-bookings.push():[booking-data:().id];_.bookings.push():[booking-data:().id];_.total-booked-base-fare-usd=_.total-booked-base-fare-usd+__.total-base-fare-usd;_.total-booked-taxes-usd=_.total-booked-taxes-usd+__.total-taxes-usd;_.total-booked-fees-usd=_.total-booked-fees-usd+__.total-fees-usd;_.total-booked-additional-profit-usd=_.total-booked-additional-profit-usd+__.total-additional-profit-usd;_.total-booked-usd=_.total-booked-usd+__.total-usd;_.total-booked-commission-usd=_.total-booked-commission-usd+__.total-commission-usd;_.total-booked-payable-usd=_.total-booked-payable-usd+__.total-payable-usd;_.total-av-seats=[_.total-av-seats||_.total-seats]-[__.total-seats];_.total-booked-seats=_.total-booked-seats+__.total-seats;_.total-booked-passengers=_.total-booked-passengers+__.total-passengers;__.seats._():[__.seats.find():[sub-class=_.class]._():[_.total-booked-base-fare-usd=[_.total-booked-base-fare-usd||0]+__.total-base-fare-usd;_.total-booked-taxes-usd=_.total-booked-taxes-usd+__.total-taxes-usd;_.total-booked-fees-usd=_.total-booked-fees-usd+__.total-fees-usd;_.total-booked-additional-profit-usd=_.total-booked-additional-profit-usd+__.total-additional-profit-usd;_.total-booked-usd=_.total-booked-usd+__.total-usd;_.total-booked-commission-usd=_.total-booked-commission-usd+__.total-commission-usd;_.total-booked-payable-usd=_.total-booked-payable-usd+__.total-payable-usd;_.total-av-seats=[_.total-av-seats]-[__.total-seats];_.total-booked-seats=_.total-booked-seats+__.total-seats;_.total-booked-passengers=_.total-booked-passengers+__.total-passengers]];_.total-open-bookings-base-fare-usd=[_.total-open-bookings-base-fare-usd||0]+__.total-base-fare-usd;_.total-open-bookings-taxes-usd=[_.total-open-bookings-taxes-usd||0]+__.total-taxes-usd;_.total-open-bookings-fees-usd=[_.total-open-bookings-fees-usd||0]+__.total-fees-usd;_.total-open-bookings-additional-profit-usd=[_.total-open-bookings-additional-profit-usd||0]+__.total-additional-profit-usd;_.total-open-bookings-usd=[_.total-open-bookings-usd||0]+__.total-usd;_.total-open-bookings-commission-usd=[_.total-open-bookings-commission-usd||0]+__.total-commission-usd;_.total-open-bookings-payable-usd=[_.total-open-bookings-payable-usd||0]+__.total-payable-usd;_.total-open-bookings-seats=[_.total-open-bookings-seats||0]+__.total-seats;_.total-open-bookings-passengers=[_.total-open-bookings-passengers||0]+__.total-passengers;__.seats._():[__.seats.find():[sub-class=_.class]._():[_.total-open-bookings-base-fare-usd=[_.total-open-bookings-base-fare-usd||0]+__.total-base-fare-usd;_.total-open-bookings-taxes-usd=[_.total-open-bookings-taxes-usd||0]+__.total-taxes-usd;_.total-open-bookings-fees-usd=[_.total-open-bookings-fees-usd||0]+__.total-fees-usd;_.total-open-bookings-additional-profit-usd=[_.total-open-bookings-additional-profit-usd||0]+__.total-additional-profit-usd;_.total-open-bookings-usd=[_.total-open-bookings-usd||0]+__.total-usd;_.total-open-bookings-commission-usd=[_.total-open-bookings-commission-usd||0]+__.total-commission-usd;_.total-open-bookings-payable-usd=[_.total-open-bookings-payable-usd||0]+__.total-payable-usd;_.total-open-bookings-seats=[_.total-open-bookings-seats||0]+__.total-seats;_.total-open-bookings-passengers=[_.total-open-bookings-passengers||0]+__.total-passengers]]]];save():[collection=flight-booking;data=booking-data:()]:[booking-details:()=_list;flights:()=_list;flights-booked:()=_list];save():[collection=flight;data=my-flights:()]:[my-flights:()=_list];save():[collection=flight-invoice;data=my-flight-invoices:()]:[my-flight-invoices:()=_list];():book-a-flight-list.children().():rem();():flight-booking-sidebar-btn.click();update():[pricing-bar];note():[text=Seats booked successfully!];bookings:()=_list:[booking-data:().clone()];unreset-booking:()=true;booking-data:().del();update():[bookings-list];next().click();loader.hide?booking-data:().accept-terms-and-conditions;if():[booking-data:().clone().booking-details.find():[seats.find():[passengers-details.find():[!last-name||!first-name||if():[infants.len()>0]:[infants.find():[!first-name||!last-name]]:false]]]]:[if():[agent:().admin]:true:false]:true"
                }
              ],
              "type": "Text?id=book-seats-btn;class=flexbox pointer;text=Book;style:[height=3rem;borderRadius=1.5rem;width=10rem;color=#fff;backgroundColor=blue;fontSize=1.3rem;opacity=0.8;transition=.3s];hover.style.opacity=1?!booking-edit-readonly:();!booking-edit:();booking-data:().status=Loading"
            },
            {
              "type": "Text:close-bookings-window?class=flexbox pointer;text=Cancel;style:[height=3rem;borderRadius=1.5rem;width=10rem;color=#fff;backgroundColor=#888;fontSize=1.3rem;opacity=0.8;transition=.3s];hover.style.opacity=1",
              "controls": [
                {
                  "event": "click?loader.show;():bookings-mini-window.style():[opacity=0;pointerEvents=none;padding=10vh 5vw;zIndex=1];style():[1stChild():bookings-mini-window].borderRadius=1rem;booking-edit:().del();booking-data:().del();new-booking:().del();loader.hide"
                }
              ]
            }
          ]
        }
      ],
      "type": "View?class=flex column;style:[width=100%;padding=1rem;borderRadius=1rem;backgroundColor=#fff;cursor=default;gap=2rem;overflowY=auto;height=100%;position=relative]?booking-data:()"
    }
  ],
  "id": "bookings-mini-window",
  "functions": {
    "issueBookingReissue": "search():[collection=agent;doc=booking-data:().agent]:[my-agent:()=search:().data;if():[my-agent:().balance-usd>booking-data:().total-payable-usd+old-booking:().total-payable-usd||my-agent:().balance-usd=booking-data:().total-payable-usd+old-booking:().total-payable-usd]:[booking-data:().():[history=_list:[_map:user:[user:().id]:user-name:[user:().username]:agent:[agent:().id]:agent-name:[agent:().company-name]:description:['Booking has been reissued.']:status:Confirmed:date:[today().timestamp()]];#names=booking-data:().booking-details.clone().0.seats.():[passengers-details.():[first-name+ +last-name]].flat().join(): +if():[booking-data:().booking-details.clone().0.seats.():[passengers-details.():[infants].flat().filter()].flat().filter().len()>0]:[ +booking-data:().booking-details.clone().0.seats.():[passengers-details.():[infants.():[first-name+ +last-name]].flat().filter()].flat().filter().join(): ];issuing-day=todayStart();issuing-month=monthStart();issuing-year=yearStart();issued-by=user:().id;issued-by-name=user:().username;issued-by-agent=agent:().id;issued-by-agent-name=agent:().company-name;status=Issued;issue-date=today().timestamp();flights=my-flights:().():id;travel-date=my-flights:().0.departure-day;go-departure-airport=my-flights:().0.departure-airport;go-departure-time=my-flights:().0.departure-time;go-arrival-airport=my-flights:().0.arrival-airport;go-arrival-time=my-flights:().0.arrival-time;start-balance-usd=my-agent:().balance-usd;end-balance-usd=[my-agent:().balance-usd]-[booking-data:().total-payable-usd];my-agent:().buyings-usd=[my-agent:().buyings-usd||0]+[booking-data:().total-payable-usd];setAgentBuyingsBookings();if():[my-flights:().len()=2]:[return-date=my-flights:().1.departure-day;return-departure-airport=my-flights:().1.departure-airport;return-departure-time=my-flights:().1.departure-time;return-arrival-airport=my-flights:().1.arrival-airport;return-arrival-time=my-flights:().1.arrival-time]];search():[collection=collection;doc=counter]:[collections:().counter=().search.data;if():[!booking-edit:()]:[booking-data:().booking-details._():[my-flights:().find():[id=_.flight-id]._():[_.total-av-seats=[_.total-av-seats||_.total-seats]-[__.total-seats];__.seats._():[__.seats.find():[sub-class=_.class]._():[_.av-seats=[_.av-seats]-[__.total-seats]]]]]];().reservations-details=booking-data:().clone().booking-details._():[_.seats._():[_.passengers-details.():[id=[gen():20];pnr=booking-data:().pnr;booking=booking-data:().id;status=Issued;type=booking-data:().type;flight-number=__.flight-number;flight-id=__.flight-id;departure-airport=__.departure-airport;arrival-airport=__.arrival-airport;departure-day=__.departure-day;arrival-day=__.arrival-day;departure-time=__.departure-time;arrival-time=__.arrival-time;aircraft=__.aircraft;airline=__.airline;flight-duration=__.flight-duration;flight-type=__.flight-type;stops=__.stops;booking-policy=_.booking-policy;change-policy=_.change-policy;cancelation-policy=_.cancelation-policy;class=_.class;head-class=_.head-class;baggage-kg=_.baggage-kg;meal-included=_.meal-included;terms-and-conditions=__.terms-and-conditions;if():[infants.len()>0]:[_.'passengers-details'.push():[infants.clone().():[id=[gen():20];pnr=booking-data:().pnr;status=Issued;type=booking-data:().type;flight-number=__.flight-number;flight-id=__.flight-id;departure-airport=__.departure-airport;arrival-airport=__.arrival-airport;departure-day=__.departure-day;arrival-day=__.arrival-day;departure-time=__.departure-time;arrival-time=__.arrival-time;aircraft=__.aircraft;airline=__.airline;flight-duration=__.flight-duration;flight-type=__.flight-type;stops=__.stops;booking-policy=_.booking-policy;change-policy=_.change-policy;cancelation-policy=_.cancelation-policy;class=_.class;head-class=_.head-class;baggage-kg=_.baggage-kg;meal-included=_.meal-included;terms-and-conditions=__.terms-and-conditions]]]]]].():[seats.():passengers-details.flat()].flat();my-reservations:()=_list;().my-counters=_list;().reservations-details._():[if():[!_.counter.in():[().my-counters]]:[().my-counters.push():[_.counter];if():[user:().username!=test]:[collections:().counter.e-ticket=counter():[collections:().counter.e-ticket]];my-reservations:().push():[_map:history:[_list:[_map:user:[user:().id]:user-name:[user:().username]:agent:[agent:().id]:agent-name:[agent:().company-name]:description:['New ticket has been issued.']:status:Confirmed:date:[today().timestamp()]]]:id:[gen():20]:pnr:[booking-data:().pnr]:e-ticket:[collections:().counter.e-ticket.counter]:creation-date:[today().timestamp()]:day:todayStart():month:monthStart():year:yearStart():status:Confirmed:user:[booking-data:().user]:user-name:[booking-data:().user-name]:issued-by:[user:().id]:issued-by-name:[user:().username]:agent:[booking-data:().agent]:agent-name:[booking-data:().agent-name]:issued-by-agent:[booking-data:().agent]:issued-by-agent-name:[booking-data:().agent-name]:type:[booking-data:().type]:flights:[my-flights:().():id]:travel-date:[my-flights:().0.departure-day]:go-departure-airport:[my-flights:().0.departure-airport]:go-departure-time:[my-flights:().0.departure-time]:go-arrival-airport:[my-flights:().0.arrival-airport]:go-arrival-time:[my-flights:().0.arrival-time]:return-date:[my-flights:().1.departure-day]:return-departure-airport:[my-flights:().1.departure-airport]:return-departure-time:[my-flights:().1.departure-time]:return-arrival-airport:[my-flights:().1.arrival-airport]:return-arrival-time:[my-flights:().1.arrival-time]:booking:[booking-data:().id]:reservation-details:[().reservations-details.filter():[counter=_.counter]]]]];my-reservations:()._():[if():[_.reservation-details.0.parent-counter]:[_.parent-e-ticket=my-reservations:().find():[reservation-details.0.counter=_.reservation-details.0.parent-counter].e-ticket;_.parent-reservation=my-reservations:().find():[reservation-details.0.counter=_.reservation-details.0.parent-counter].id];_.total-base-fare-usd=_.reservation-details.():base-fare-usd.sum();_.total-taxes-usd=_.reservation-details.():taxes-usd.sum();_.total-fees-usd=_.reservation-details.():fees-usd.sum();_.total-additional-profit-usd=_.reservation-details.():additional-profit-usd.sum();_.total-commission-usd=_.reservation-details.():commission-usd.sum();_.total-usd=_.reservation-details.():total-usd.sum();_.total-payable-usd=_.reservation-details.():payable-usd.sum()];booking-data:().booking-details._():[my-flight-invoices:().find():[flight-id=_.flight-id]._():[_.bookings.push():[booking-data:().id];_.pnrs.push():[booking-data:().pnr];_.reservations.push():[my-reservations:().():id];_.tickets.push():[my-reservations:().():e-ticket];_.total-av-seats=[_.total-av-seats||_.total-seats]-[__.total-seats];__.seats._():[__.seats.find():[sub-class=_.class]._():[_.av-seats=[_.av-seats]-[__.total-seats]]];_.total-reserved-base-fare-usd=[_.total-reserved-base-fare-usd||0]+[__.total-base-fare-usd];_.total-reserved-taxes-usd=[_.total-reserved-taxes-usd||0]+[__.total-taxes-usd];_.total-reserved-fees-usd=[_.total-reserved-fees-usd||0]+[__.total-fees-usd];_.total-reserved-additional-profit-usd=[_.total-reserved-additional-profit-usd||0]+[__.total-additional-profit-usd];_.total-reserved-usd=[_.total-reserved-usd||0]+[__.total-usd];_.total-reserved-commission-usd=[_.total-reserved-commission-usd||0]+[__.total-commission-usd];_.total-reserved-payable-usd=[_.total-reserved-payable-usd||0]+[__.total-payable-usd];_.total-reserved-seats=[_.total-reserved-seats||0]+[__.total-seats];_.total-reserved-passengers=[_.total-reserved-passengers||0]+[__.total-passengers];__.seats._():[__.seats.find():[sub-class=_.class]._():[_.total-reserved-base-fare-usd=[_.total-reserved-base-fare-usd||0]+[__.total-base-fare-usd];_.total-reserved-taxes-usd=[_.total-reserved-taxes-usd||0]+[__.total-taxes-usd];_.total-reserved-fees-usd=[_.total-reserved-fees-usd||0]+[__.total-fees-usd];_.total-reserved-additional-profit-usd=[_.total-reserved-additional-profit-usd||0]+[__.total-additional-profit-usd];_.total-reserved-usd=[_.total-reserved-usd||0]+[__.total-usd];_.total-reserved-commission-usd=[_.total-reserved-commission-usd||0]+[__.total-commission-usd];_.total-reserved-payable-usd=[_.total-reserved-payable-usd||0]+[__.total-payable-usd];_.total-reserved-seats=[_.total-reserved-seats||0]+[__.total-seats];_.total-reserved-passengers=[_.total-reserved-passengers||0]+[__.total-passengers]]]]];my-reservations:()._():[_.reservation-details.():[e-ticket=_.e-ticket;pnr=_.pnr]];my-reservations:()._():[_.start-balance-usd=my-agent:().balance-usd;_.end-balance-usd=[my-agent:().balance-usd||0]-[_.total-payable-usd];_.reservation-details._():[_.start-balance-usd=my-agent:().balance-usd;my-agent:().balance-usd=[my-agent:().balance-usd||0]-[_.payable-usd];_.end-balance-usd=my-agent:().balance-usd]];booking-data:().reservations=my-reservations:().():id;booking-data:().tickets=my-reservations:().():e-ticket;booking-data:().booking-details.():[seats.():[passengers-details.():[status=Issued];status=Issued];status=Issued];my-agent:().bookings=[my-agent:().bookings||0]+1;save():[collection=agent;data=my-agent:().clone()]:[my-agent:().del()];save():[collection=flight-booking;data=booking-data:()];save():[collection=flight-reservation;data=my-reservations:()]:[my-reservations:()=_list];save():[collection=collection;doc=counter;data=collections:().counter];save():[collection=flight-invoice;data=my-flight-invoices:()];save():[collection=flight;data=my-flights:()];bookings:()=_list:[booking-data:().clone()];cancelBookingReissue()]]:[note():[text=Not enough balance in your account!;type=danger];loader.hide]]",
    "cancelBookingReissue": "old-booking:().new-booking=booking-data:().id;booking-data:()=old-booking:().clone();if():[booking-data:().end-balance-usd]:[booking-data:()._():[_.canceled-start-balance-usd=my-agent:().balance-usd;_.canceled-end-balance-usd=my-agent:().balance-usd+_.total-payable-usd;my-agent:().buyings-usd=[my-agent:().buyings-usd]-[_.total-payable-usd];if():[my-agent:().today=todayStart().timestamp()]:[my-agent:().today-buyings-usd=[my-agent:().today-buyings-usd||0]-[booking-data:().total-payable-usd];my-agent:().today-bookings=[my-agent:().today-bookings||0]-1]:[my-agent:().today=todayStart().timestamp();my-agent:().today-buyings-usd=0;my-agent:().today-bookings=0]]];booking-data:().():[history=[booking-data:().history||_list].list();history.push():[_map:user:[user:().id]:user-name:[user:().username]:agent:[agent:().id]:agent-name:[agent:().company-name]:description:['Booking has been reissued.']:status:Confirmed:date:[today().timestamp()]];cancelation-day=todayStart();cancelation-month=monthStart();cancelation-year=yearStart();canceled-by=user:().id;canceled-by-name=user:().username;canceled-by-agent=agent:().id;canceled-by-agent-name=agent:().company-name;status=Canceled;cancelation-date=today().timestamp();total-canceled-passengers=booking-data:().total-passengers;total-canceled-seats=booking-data:().total-seats;total-canceled-base-fare-usd=booking-data:().total-base-fare-usd;total-canceled-fees-usd=booking-data:().total-fees-usd;total-canceled-taxes-usd=booking-data:().total-taxes-usd;total-canceled-commission-usd=[booking-data:().total-commission-usd||0];canceled-total-usd=booking-data:().total-usd;total-canceled-payable-usd=booking-data:().total-payable-usd;booking-details._():[_.canceled-passengers=_.total-passengers;_.canceled-seats=_.total-seats;_.total-canceled-base-fare-usd=_.total-base-fare-usd;_.total-canceled-fees-usd=_.total-fees-usd;_.total-canceled-taxes-usd=_.total-taxes-usd;_.total-canceled-commission-usd=[_.total-commission-usd||0];_.canceled-total-usd=_.total-usd;_.total-canceled-payable-usd=_.total-payable-usd;_.status=Canceled;_.seats._():[_.canceled-passengers=_.total-passengers;_.canceled-seats=_.total-seats;_.total-canceled-base-fare-usd=_.total-base-fare-usd;_.total-canceled-fees-usd=_.total-fees-usd;_.total-canceled-taxes-usd=_.total-taxes-usd;_.total-canceled-commission-usd=[_.total-commission-usd||0];_.total-canceled-total-usd=_.total-usd;_.total-canceled-payable-usd=_.total-payable-usd;_.status=Canceled;_.passengers-details._():[_.canceled-base-fare-usd=_.base-fare-usd;_.canceled-fees-usd=_.fees-usd;_.canceled-taxes-usd=_.taxes-usd;_.canceled-commission-usd=[_.commission-usd||0];_.canceled-total-usd=_.total-usd;_.canceled-payable-usd=_.payable-usd;_.status=Canceled;if():[_.infants.len()>0]:[_.infants._():[_.canceled-base-fare-usd=_.base-fare-usd;_.canceled-fees-usd=_.fees-usd;_.canceled-taxes-usd=_.taxes-usd;_.canceled-commission-usd=[_.commission-usd||0];_.canceled-total-usd=_.total-usd;_.canceled-payable-usd=_.payable-usd;_.status=Canceled]]]]]];search():[collection=flight;docs=booking-data:().flights.clone()]:[my-flights:()=search:().data.values().clone();my-flights:()._():[_.total-av-seats=[_.total-av-seats||0]+booking-data:().booking-details.0.total-seats];booking-data:().booking-details._():[my-flights:().find():[id=_.flight-id].seats.filter():[sub-class.in():[_.seats.():class]]._():[_.av-seats=[_.av-seats||0]+__.seats.find():[class=_.sub-class].total-seats]];search():[collection=flight-invoice;field.flight-id.in=booking-data:().flights.clone()]:[my-flight-invoices:()=search:().data.values();booking-data:().booking-details._():[my-flight-invoices:().find():[flight-id=_.flight-id]._():[_.canceled-bookings=[_.canceled-bookings||_list];_.canceled-bookings.push():[booking-data:().id];_.canceled-reserved-bookings=[_.canceled-reserved-bookings||_list];_.canceled-reserved-bookings.push():[booking-data:().id];_.total-av-seats=[_.total-av-seats]+__.total-seats;_.total-canceled-reserved-base-fare-usd=[_.total-canceled-reserved-base-fare-usd||0]+__.total-base-fare-usd;_.total-canceled-reserved-taxes-usd=[_.total-canceled-reserved-taxes-usd||0]+__.total-taxes-usd;_.total-canceled-reserved-fees-usd=[_.total-canceled-reserved-fees-usd||0]+__.total-fees-usd;_.total-canceled-reserved-additional-profit-usd=[_.total-canceled-reserved-additional-profit-usd||0]+__.total-additional-profit-usd;_.total-canceled-reserved-usd=[_.total-canceled-reserved-usd||0]+__.total-usd;_.total-canceled-reserved-commission-usd=[_.total-canceled-reserved-commission-usd||0]+__.total-commission-usd;_.total-canceled-reserved-payable-usd=[_.total-canceled-reserved-payable-usd||0]+__.total-payable-usd;_.total-canceled-reserved-seats=[_.total-canceled-reserved-seats||0]+__.total-seats;_.total-canceled-reserved-passengers=[_.total-canceled-reserved-passengers||0]+__.total-passengers;__.seats._():[__.seats.find():[sub-class=_.class]._():[_.total-canceled-reserved-base-fare-usd=[_.total-canceled-reserved-base-fare-usd||0]+__.total-base-fare-usd;_.total-canceled-reserved-taxes-usd=[_.total-canceled-reserved-taxes-usd||0]+__.total-taxes-usd;_.total-canceled-reserved-fees-usd=[_.total-canceled-reserved-fees-usd||0]+__.total-fees-usd;_.total-canceled-reserved-additional-profit-usd=[_.total-canceled-reserved-additional-profit-usd||0]+__.total-additional-profit-usd;_.total-canceled-reserved-usd=[_.total-canceled-reserved-usd||0]+__.total-usd;_.total-canceled-reserved-commission-usd=[_.total-canceled-reserved-commission-usd||0]+__.total-commission-usd;_.total-canceled-reserved-payable-usd=[_.total-canceled-reserved-payable-usd||0]+__.total-payable-usd;_.total-av-seats=[_.total-av-seats]+__.total-seats;_.total-canceled-reserved-seats=[_.total-canceled-reserved-seats||0]+__.total-seats;_.total-canceled-reserved-passengers=[_.total-canceled-reserved-passengers||0]+__.total-passengers]]]];search():[collection=flight-reservation;docs=booking-data:().reservations]:[my-tickets:()=search:().data.values();if():[booking-data:().end-balance-usd]:[my-tickets:()._():[_.canceled-start-balance-usd=my-agent:().balance-usd;_.canceled-end-balance-usd=[my-agent:().balance-usd]+[_.total-payable-usd];_.reservation-details._():[_.canceled-start-balance-usd=my-agent:().balance-usd;my-agent:().balance-usd=[my-agent:().balance-usd]+[_.payable-usd];_.canceled-end-balance-usd=my-agent:().balance-usd]]];my-tickets:()._():[_.history=[_.history||_list].list();_.history.push():[_map:user:[user:().id]:user-name:[user:().username]:agent:[agent:().id]:agent-name:[agent:().company-name]:description:['Ticket has been canceled.']:status:Confirmed:date:[today().timestamp()]];_.status=Canceled;_.cancelation-day=todayStart();_.cancelation-month=monthStart();_.cancelation-year=yearStart();_.canceled-by=user:().id;_.canceled-by-name=user:().username;_.canceled-by-agent=agent:().id;_.canceled-by-agent-name=agent:().company-name;_.cancelation-date=today().timestamp();_.total-canceled-base-fare-usd=[_.total-canceled-base-fare-usd||0]+_.total-base-fare-usd;_.total-canceled-fees-usd=[_.total-canceled-fees-usd||0]+_.total-fees-usd;_.total-canceled-taxes-usd=[_.total-canceled-taxes-usd||0]+_.total-taxes-usd;_.total-canceled-commission-usd=[_.total-canceled-commission-usd||0]+_.total-commission-usd;_.canceled-total-usd=[_.canceled-total-usd||0]+_.total-usd;_.total-canceled-payable-usd=[_.total-canceled-payable-usd||0]+_.total-payable-usd;_.reservation-details._():[_.status=Canceled;_.cancelation-day=todayStart();_.cancelation-month=monthStart();_.cancelation-year=yearStart();_.canceled-by=user:().id;_.canceled-by-name=user:().username;_.canceled-by-agent=agent:().id;_.canceled-by-agent-name=agent:().company-name;_.cancelation-date=today().timestamp();_.canceled-base-fare-usd=[_.canceled-base-fare-usd||0]+_.base-fare-usd;_.canceled-fees-usd=[_.canceled-fees-usd||0]+_.fees-usd;_.canceled-taxes-usd=[_.canceled-taxes-usd||0]+_.taxes-usd;_.canceled-commission-usd=[_.canceled-commission-usd||0]+_.commission-usd;_.canceled-total-usd=[_.canceled-total-usd||0]+_.total-usd;_.canceled-payable-usd=[_.canceled-payable-usd||0]+_.payable-usd]];if():[booking-data:().end-balance-usd]:[my-agent:().bookings=[my-agent:().bookings||0]-1;save():[collection=agent;data=my-agent:().clone()]:[my-agent:().del()]];save():[collection=flight-reservation;data=my-tickets:()]:[my-tickets:()=_list];save():[collection=flight-invoice;data=my-flight-invoices:()]:[my-flight-invoices:()=_list];save():[collection=flight;data=my-flights:()]:[my-flights:()=_list];save():[collection=flight-booking;data=booking-data:()];old-booking:().del();():book-a-flight-list.children().():rem();update():pricing-bar;update():bookings-list;bookings:()=_list:[booking-data:().clone()];booking-data:().del();unreset-booking:()=true;():flight-booking-sidebar-btn.click();next().click();booking-edit:().del();note():[text=Booking reissued successfully!];loader.hide]]]",
    "updateTicketsDataSplit": "search():[collection=flight-reservation;docs=booking-data:().reservations]:[my-reservations:()=search:().data.values();booking-data:().():[reservations=_list;tickets=_list];new-booking-data:().():[reservations=_list;tickets=_list];my-reservations:()._():[if():[_.reservation-details.0.counter.in():[().counters]]:[new-booking-data:().():[reservations.push():[_.id];tickets.push():[_.e-ticket]];_.pnr=new-booking-data:().pnr;_.booking=new-booking-data:().id;_.reservation-details.():[pnr=new-booking-data:().pnr]]:[booking-data:().():[reservations.push():[_.id];tickets.push():[_.e-ticket]]]];updateFlightInvoiceSplit()]",
    "updateBookingDataSplit": "booking-data:().():[history=[booking-data:().history||_list];history.push():[_map:user:[user:().id]:user-name:[user:().username]:agent:[agent:().id]:agent-name:[agent:().company-name]:description:['Split tickets: '+().splited-data.clone().():[type+ +first-name+ +last-name]]:status:Confirmed:date:[today().timestamp()]];splited=().splited-data;edit-day=todayStart();edit-month=monthStart();edit-year=yearStart();edited-by=user:().id;edited-by-name=user:().username;edited-by-agent=agent:().id;edited-by-agent-name=agent:().company-name;status=Issued;edit-date=today().timestamp()];booking-data:()._():[_.booking-details._():[_.seats._():[_.total-seats=_.[passengers-details].len();_.adults=_.[passengers-details].filter():[age=ADT].len();_.children=_.[passengers-details].filter():[age=CHD].len();_.infants=_.[passengers-details].filter():[infants.len()>0].len();_.total-passengers=_.[passengers-details].len()+_.infants;_.passengers=_.total-passengers;_.total-base-fare-usd=_.[passengers-details].():[base-fare-usd].sum();_.total-commission-usd=_.[passengers-details].():[commission-usd].sum();_.total-taxes-usd=_.[passengers-details].():[taxes-usd].sum();_.total-fees-usd=_.[passengers-details].():[fees-usd].sum();_.total-additional-profit-usd=_.[passengers-details].():[additional-profit-usd].sum();_.total-usd=_.[passengers-details].():[total-usd].sum();_.total-payable-usd=_.[passengers-details].():[payable-usd].sum()];_.total-seats=_.seats.():[total-seats].sum();_.total-adults=_.seats.():[adults].sum();_.total-children=_.seats.():[children].sum();_.total-infants=_.seats.():[infants].sum();_.total-passengers=_.seats.():[total-passengers].sum();_.total-base-fare-usd=_.seats.():[total-base-fare-usd].sum();_.total-commission-usd=_.seats.():[total-commission-usd].sum();_.total-taxes-usd=_.seats.():[total-taxes-usd].sum();_.total-fees-usd=_.seats.():[total-fees-usd].sum();_.total-additional-profit-usd=_.seats.():[total-additional-profit-usd].sum();_.total-usd=_.seats.():[total-usd].sum();_.total-payable-usd=_.seats.():[total-payable-usd].sum()];_.total-seats=_.booking-details.0.total-seats;_.total-passengers=_.booking-details.0.total-passengers;_.total-base-fare-usd=_.booking-details.():[total-base-fare-usd].sum();_.total-commission-usd=_.booking-details.():[total-commission-usd].sum();_.total-taxes-usd=_.booking-details.():[total-taxes-usd].sum();_.total-fees-usd=_.booking-details.():[total-fees-usd].sum();_.total-additional-profit-usd=_.booking-details.():[total-additional-profit-usd].sum();_.total-usd=_.booking-details.():[total-usd].sum();_.total-payable-usd=_.booking-details.():[total-payable-usd].sum();_.start-balance-usd=_.start-balance-usd;if():[_.start-balance-usd]:[_.end-balance-usd=_.start-balance-usd+_.total-payable-usd]]",
    "updateFlightInvoiceSplit": "search():[collection=flight-invoice;field.flight-id.in=booking-data:().flights]:[my-invoices:()=search:().data.values();my-invoices:().():[bookings.push():[new-booking-data:().id];pnrs.push():[new-booking-data:().pnr]];save():[collection=flight-invoice;data=my-invoices:()]:[my-invoices:().del()];save():[collection=flight-reservation;data=my-reservations:()]:[my-reservations:().del()];save():[collection=flight-booking;data=_list:[booking-data:()]:[new-booking-data:()]]:[bookings:().push():[new-booking-data:().clone()];bookings:().push():[booking-data:().clone()];update():[bookings-list];new-booking-data:().del();booking-data:().del();():close-bookings-window.click();loader.hide]]",
    "updateNewBookingDataSplit": "new-booking-data:().():[pnr=gen():6.touppercase();id=gen():20;history=_list:[_map:user:[user:().id]:user-name:[user:().username]:agent:[agent:().id]:agent-name:[agent:().company-name]:description:['Booking created from a split from pnr '+booking-data:().pnr]:status:Confirmed:date:[today().timestamp()]]];new-booking-data:()._():[_.creation-date=_.creation-date+1;_.issuing-date=[_.issuing-date||_.issue-date]+1;_.booking-details._():[_.seats._():[_.total-seats=_.[passengers-details].len();_.adults=_.[passengers-details].filter():[age=ADT].len();_.children=_.[passengers-details].filter():[age=CHD].len();_.infants=_.[passengers-details].filter():[infants.len()>0].len();_.total-passengers=_.[passengers-details].len()+_.infants;_.passengers=_.total-passengers;_.total-base-fare-usd=_.[passengers-details].():[base-fare-usd].sum();_.total-commission-usd=_.[passengers-details].():[commission-usd].sum();_.total-taxes-usd=_.[passengers-details].():[taxes-usd].sum();_.total-fees-usd=_.[passengers-details].():[fees-usd].sum();_.total-additional-profit-usd=_.[passengers-details].():[additional-profit-usd].sum();_.total-usd=_.[passengers-details].():[total-usd].sum();_.total-payable-usd=_.[passengers-details].():[payable-usd].sum()];_.total-seats=_.seats.():[total-seats].sum();_.total-adults=_.seats.():[adults].sum();_.total-children=_.seats.():[children].sum();_.total-infants=_.seats.():[infants].sum();_.total-passengers=_.seats.():[total-passengers].sum();_.total-base-fare-usd=_.seats.():[total-base-fare-usd].sum();_.total-commission-usd=_.seats.():[total-commission-usd].sum();_.total-taxes-usd=_.seats.():[total-taxes-usd].sum();_.total-fees-usd=_.seats.():[total-fees-usd].sum();_.total-additional-profit-usd=_.seats.():[total-additional-profit-usd].sum();_.total-usd=_.seats.():[total-usd].sum();_.total-payable-usd=_.seats.():[total-payable-usd].sum()];_.total-seats=_.booking-details.0.total-seats;_.total-passengers=_.booking-details.0.total-passengers;_.total-base-fare-usd=_.booking-details.():[total-base-fare-usd].sum();_.total-commission-usd=_.booking-details.():[total-commission-usd].sum();_.total-taxes-usd=_.booking-details.():[total-taxes-usd].sum();_.total-fees-usd=_.booking-details.():[total-fees-usd].sum();_.total-additional-profit-usd=_.booking-details.():[total-additional-profit-usd].sum();_.total-usd=_.booking-details.():[total-usd].sum();_.total-payable-usd=_.booking-details.():[total-payable-usd].sum();if():[booking-data:().end-balance-usd]:[_.start-balance-usd=booking-data:().end-balance-usd;_.end-balance-usd=_.start-balance-usd+_.total-payable-usd]]",
    "setAgentBuyingsBookings": "if():[my-agent:().today=todayStart().timestamp()]:[my-agent:().today-buyings-usd=[my-agent:().today-buyings-usd||0]+[booking-data:().total-payable-usd];my-agent:().today-bookings=[my-agent:().today-bookings||0]+1]:[my-agent:().today=todayStart().timestamp();my-agent:().today-buyings-usd=booking-data:().total-payable-usd;my-agent:().today-bookings=1]"
  }
}