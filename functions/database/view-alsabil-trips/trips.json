{
  "type": "View:trips?trips:()=_list",
  "children": [
    {
      "children": [
        {
          "type": "View?class=flex align-center;if():[!new-trip:()||new-trip:().keys().len()=0]:[new-trip:()=_map:created-by:[user:().id]:created-by-name:[user:().first-name+ +user:().last-name]:creation-date:[today().timestamp()]:day:todayStart():month:monthStart():year:yearStart():id:[gen():20]:visits:0:total-payments-usd:0:total-payment-lbp:0];style:[minHeight=4rem;padding=0 1rem;borderLeft=3px solid blue;width=100%;backgroundColor=#f6f6f6]",
          "children": [
            {
              "type": "Text?text=New Trip;style:[fontSize=2rem]"
            }
          ]
        },
        {
          "type": "View?class=vertical;style:[flex=1;width=100%;gap=2rem;paddingTop=1rem]",
          "children": [
            {
              "type": "Input?path=name;label:[text=Trip Name;fontSize=1.2rem];style:[width=100%;height=4rem;border=1px solid #ddd;fontSize=1.3rem;borderRadius=.5rem];keyup:[data()=data().capitalize();txt()=data()]"
            },
            {
              "type": "Input?if():[!data().status]:[data().status=Open];path=status;readonly;label:[text=Status;fontSize=1.2rem];style:[width=100%;height=4rem;border=1px solid #ddd;fontSize=1.3rem;borderRadius=.5rem];droplist.items=_list:Draft:Open:Closed:Canceled"
            },
            {
              "type": "Input?if():[!data().leader]:[data().leader=user:().first-name+ +user:().last-name];path=leader;label:[text=Leader;fontSize=1.2rem];style:[width=100%;height=4rem;border=1px solid #ddd;fontSize=1.3rem;borderRadius=.5rem];keyup:[data()=data().capitalize();txt()=data()]"
            },
            {
              "type": "Input?path=passengers;label:[text=Passengers;fontSize=1.2rem];input.type=number;style:[width=100%;height=4rem;border=1px solid #ddd;fontSize=1.3rem;borderRadius=.5rem]"
            },
            {
              "type": "Input?path=car;label:[text=Car Type;fontSize=1.2rem];style:[width=100%;height=4rem;border=1px solid #ddd;fontSize=1.3rem;borderRadius=.5rem];droplist.items=_list:Car:H1:Mini Bus:Temsa:Auto Bus"
            },
            {
              "type": "Input?path=package;label:[text=Package;fontSize=1.2rem];readonly;style:[width=100%;height=4rem;border=1px solid #ddd;fontSize=1.3rem;borderRadius=.5rem];droplist.items='packages:().():name'"
            },
            {
              "type": "Input?path=entry-date;input.type=date;label:[text=Entry Date;fontSize=1.2rem];style:[width=100%;height=4rem;border=1px solid #ddd;fontSize=1.3rem;borderRadius=.5rem];change:[data()=data().timestamp()]"
            },
            {
              "type": "Input?path=leave-date;input.type=date;label:[text=Leave Date;fontSize=1.2rem];style:[width=100%;height=4rem;border=1px solid #ddd;fontSize=1.3rem;borderRadius=.5rem];change:[data()=data().timestamp()]"
            },
            {
              "type": "Input?path=description;textarea;label:[text=Trip Description;fontSize=1.2rem];style:[width=100%;minHeight=8rem;border=1px solid #ddd;fontSize=1.3rem;borderRadius=.5rem]"
            },
            {
              "type": "Input?path=contact-number;label:[text=Contact Number;fontSize=1.2rem];style:[width=100%;height=4rem;border=1px solid #ddd;fontSize=1.3rem;borderRadius=.5rem]"
            },
            {
              "children": [
                {
                  "children": [
                    {
                      "type": "Text?text=if():[!edit-trip:()]:Create:Save;style:[color=#fff;fontSize=1.4rem]"
                    }
                  ],
                  "controls": [
                    {
                      "event": "click?loader.show;save():[collection=trip;data=new-trip:()]:[trips:().replaceItem():[new-trip:()].sort():[path=entry-date;descending];new-trip:().del();update():trip-list;():new-trip.style():[opacity=0;pointerEvents=none];edit-trip:().del();loader.hide]?data().name;data().leader;data().car;data().entry-date;data().leave-date"
                    }
                  ],
                  "type": "View?class=flexbox;style:[width=100%;height=3.5rem;borderRadius=1.5rem;opacity=.8;backgroundColor=blue]"
                },
                {
                  "children": [
                    {
                      "type": "Text?text=Cancel;style:[color=#fff;fontSize=1.4rem]"
                    }
                  ],
                  "type": "View?class=flexbox;style:[width=100%;height=3.5rem;borderRadius=1.5rem;opacity=.8;backgroundColor=#888];click:[():new-trip.style():[opacity=0;pointerEvents=none];edit-trip:().del()]"
                }
              ],
              "type": "View?class=grid;style:[gap=5rem;gridTemplateColumns=1fr 1fr;marginTop=auto;paddingTop=1rem]"
            }
          ]
        }
      ],
      "type": "View:new-trip?Data=new-trip;class=vertical;style:[position=fixed;padding=1rem;paddingBottom=3rem;top=0;left=0;right=0;bottom=0;overflowY=auto;opacity=0;pointerEvents=none;transition=.2s;backgroundColor=#fff;gap=2rem;zIndex=2]"
    },
    {
      "children": [
        {
          "type": "Text?class=flexbox;text=Trips;style:[height=3.5rem;padding=0 1rem;fontSize=2rem;borderLeft=3px solid blue]"
        },
        {
          "type": "View?class=flexbox;style:[gap=1rem]",
          "children": [
            {
              "children": [
                {
                  "type": "Icon?name=search;google.outlined;style:[color=#888;fontSize=2rem]"
                }
              ],
              "type": "View?class=flexbox;style:[height=3.5rem;width=3.5rem;border=1px solid #ddd;borderRadius=.5rem]"
            },
            {
              "type": "View?class=flexbox;style:[height=3.5rem;width=3.5rem;border=1px solid #ddd;borderRadius=.5rem]",
              "children": [
                {
                  "type": "Icon?name=add;google.outlined;style:[color=#888;fontSize=2rem]"
                }
              ],
              "controls": [
                {
                  "event": "click?new-trip:()=_map;update():new-trip;():new-trip.style():[opacity=1;pointerEvents=auto]"
                }
              ]
            }
          ]
        }
      ],
      "type": "View?class=flexbox;style:[width=100%;height=6rem;padding=1rem;gap=1rem;justifyContent=space-between]"
    },
    {
      "type": "View:trip-list?class=vertical;style:[width=100%;gap=1rem;backgroundColor=#eee;minHeight=100vh]",
      "children": [
        {
          "children": [
            {
              "children": [
                {
                  "type": "View?class=flex vertical;style:[width=100%;gap=1rem]",
                  "children": [
                    {
                      "children": [
                        {
                          "children": [
                            {
                              "type": "Text?text=Entry Date;style:[fontSize=1.2rem;color=#888]"
                            },
                            {
                              "type": "Text?text=data().entry-date.toDateFormat();style:[fontSize=1.2rem;color=#888]"
                            }
                          ],
                          "type": "View?class=horizontal;style:[gap=.5rem;marginRight=auto]"
                        },
                        {
                          "type": "View?class=horizontal;style:[gap=.5rem];droplist.items=_list:Open:Closed:Canceled;droplist.preventDefault",
                          "children": [
                            {
                              "type": "Text?text=Leave Date;style:[fontSize=1.2rem;color=#888]"
                            },
                            {
                              "type": "Text?text=data().leave-date.toDateFormat();style:[fontSize=1.2rem;color=#888]"
                            }
                          ]
                        }
                      ],
                      "type": "View?class=flexbox;style:[width=100%;justifyContent=flex-end;padding=.5rem 0;borderBottom=1px solid #ddd]"
                    },
                    {
                      "children": [
                        {
                          "type": "Text?text=data().name;class=flexbox;style:[fontSize=1.8rem;color=blue;height=3rem]"
                        },
                        {
                          "controls": [
                            {
                              "event": "click?edit-trip:()=true;new-trip:()=data().clone();update():new-trip;():new-trip.style():[opacity=1;pointerEvents=auto]"
                            }
                          ],
                          "type": "Icon?name=edit;style:[height=3rem;width=3rem;fontSize=2rem;color=#888];google.outlined"
                        }
                      ],
                      "type": "View?class=flexbox;style:[width=100%;justifyContent=space-between]"
                    },
                    {
                      "type": "Text?text='Leader: '+data().leader+', '+data().passengers+' passengers, Car: '+data().car+', Entry Date: '+data().entry-date.toDateFormat()+', Leave Date: '+data().leave-date.toDateFormat();style:[fontSize=1.4rem;width=100%]"
                    },
                    {
                      "type": "Text?text=data().description;style:[fontSize=1.4rem;width=100%]"
                    },
                    {
                      "children": [
                        {
                          "controls": [
                            {
                              "event": "click?loader.show;trip-payments:()=true;search():[collection=payment;field.trip.equal=data().id]:[payments:()=().search.data.values().sort():[path=payment-date;descending];loader.hide;():payments-btn.click()]"
                            }
                          ],
                          "type": "View?class=horizontal;style:[gap=.5rem;marginRight=auto]",
                          "children": [
                            {
                              "type": "Text?text=if():[data().total-payments-usd||data().total-payments-lbp]:Total Payments;style:[fontSize=1.2rem;color=#888]"
                            },
                            {
                              "type": "Text?text=[data().total-payments-lbp||0].price()+' L.L | '+[data().total-payments-usd||0]+' $';style:[fontSize=1.2rem;color=#888]"
                            }
                          ]
                        },
                        {
                          "type": "View?class=horizontal;style:[gap=.5rem];droplist.items=_list:Open:Closed:Canceled;droplist.preventDefault",
                          "children": [
                            {
                              "type": "Text?text=if():[data().close-date]:Close Date;style:[fontSize=1.2rem;color=#888]"
                            },
                            {
                              "type": "Text?text=[data().close-date.toDateFormat()||data().status];style:[fontSize=1.2rem;color=#888]"
                            }
                          ],
                          "controls": [
                            {
                              "event": "click:droplist?if():[droplist-txt:()=Open]:[data().status=Open;data().close-date.del();data().cancel-date.del()].elif():[droplist-txt:()=Closed]:[data().status=Closed;data().close-date=today().timestamp();data().cancel-date.del()].elif():[droplist-txt:()]:[data().status=Canceled;data().cancel-date=today().timestamp();data().close-date.del()];save():[collection=trip;data=data()]:[update():parent()]"
                            }
                          ]
                        }
                      ],
                      "type": "View?class=flexbox;style:[width=100%;justifyContent=flex-end;borderTop=1px solid #ddd;padding=.5rem]"
                    },
                    {
                      "children": [
                        {
                          "type": "View?class=flexbox;style:[gap=.5rem;paddding=.5rem]",
                          "children": [
                            {
                              "type": "Icon?name=payments;google.outlined;style:[fontSize=2.2rem]"
                            },
                            {
                              "type": "Text?text=Collect;style:[fontSize=1.3rem]"
                            }
                          ]
                        },
                        {
                          "type": "View?class=flexbox;style:[gap=.5rem;padding=.5rem]",
                          "children": [
                            {
                              "type": "Icon?name=receipt;google.outlined;style:[fontSize=2.2rem]"
                            },
                            {
                              "type": "Text?text=Payment;style:[fontSize=1.3rem]"
                            }
                          ],
                          "controls": [
                            {
                              "event": "click?new-payment:()=_map:created-by:[user:().id]:created-by-name:[user:().first-name+ +user:().last-name]:creation-date:[today().timestamp()]:id:[gen():20]:payment-date:todayStart():payments-lbp:[_list:_map]:payments-usd:[_list:_map]:trip:[data().id]:trip-name:[data().name];update():new-payment;():new-payment.style():[opacity=1;pointerEvents=auto];my-trip:()=data().clone()"
                            }
                          ]
                        },
                        {
                          "type": "View?class=flexbox;style:[gap=.5rem;padding=.5rem]",
                          "children": [
                            {
                              "type": "Icon?name=share;google.outlined;style:[fontSize=1.8rem]"
                            },
                            {
                              "type": "Text?text=Share;style:[fontSize=1.3rem]"
                            }
                          ],
                          "controls": [
                            {
                              "event": "click?share():[text='Trip: '+data().name+' | Entry Date: '+data().entry-date.toDateFormat()+' | Leave Date: '+data().leave-date.toDateFormat()+' | Status: '+data().status+' | Total payments: '+[data().total-payments||0]+'$']"
                            }
                          ]
                        }
                      ],
                      "type": "View?class=flexbox;style:[justifyContent=space-between;paddingTop=.5rem]"
                    }
                  ]
                }
              ],
              "type": "[View]?Data=trips;class=flex vertical;style:[gap=1rem;padding=1rem;width=100%;backgroundColor=#fff]"
            }
          ],
          "type": "View?class=vertical;style:[width=100%;gap=1rem;paddingTop=1rem;paddingBottom=7rem]?trips:().len()>0"
        }
      ],
      "controls": [
        {
          "event": "loaded?search():[collection=trip]:[trips:()=[search:().data.values()||_list].sort():[path=entry-date;descending];update():'trip-list']"
        }
      ]
    }
  ],
  "id": "trips",
  "creation-date": 1658744205858
}